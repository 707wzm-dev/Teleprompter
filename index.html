<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Teleprompter por Voz</title>
<style>
  body {
    margin: 0; background: black; color: white;
    font-family: Arial, sans-serif; overflow: hidden;
  }
  #viewport {
    height: 100vh; overflow-y: hidden; position: relative;
    scroll-behavior: smooth;
  }
  #text {
    padding: 50vh 40px; /* Margen superior para que la primera frase empiece al centro */
    font-size: 45px; line-height: 1.6;
    max-width: 85%; margin: auto; outline: none;
    transition: all 0.3s ease;
  }
  .highlight { color: #2ecc71; font-weight: bold; } /* Palabra detectada */
  
  #controls {
    position: fixed; bottom: 10px; left: 50%; transform: translateX(-50%);
    display: flex; gap: 8px; background: rgba(0,0,0,0.8);
    padding: 10px; border-radius: 12px; z-index: 100;
  }
  button { padding: 10px; cursor: pointer; border-radius: 5px; border: none; }
  .active { background: red; color: white; }
  
  /* Gu√≠a visual central */
  #marker {
    position: fixed; top: 50%; left: 0; width: 100%; height: 2px;
    background: rgba(255, 255, 255, 0.2); pointer-events: none;
  }
</style>
</head>
<body>

<div id="marker"></div>

<div id="viewport">
  <div id="text" contenteditable="true" spellcheck="false">
    Pega tu guion aqu√≠. Al hablar, el sistema buscar√° las palabras y las pondr√° en el centro. 
    Prueba diciendo exactamente lo que est√° escrito en este p√°rrafo.
  </div>
</div>

<div id="controls">
  <button id="micBtn">üéôÔ∏è Iniciar Voz</button>
  <button id="plusBtn">A+</button>
  <button id="minusBtn">A-</button>
  <button id="resetBtn">üîÑ Reset</button>
</div>

<script>
const viewport = document.getElementById("viewport");
const textElem = document.getElementById("text");
const micBtn = document.getElementById("micBtn");

let recognition;
let isListening = false;

// Preparar el motor de voz
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

if (!SpeechRecognition) {
  alert("Tu navegador no soporta reconocimiento de voz. Usa Chrome en Android.");
} else {
  recognition = new SpeechRecognition();
  recognition.lang = 'es-ES';
  recognition.continuous = true;
  recognition.interimResults = true;

  recognition.onresult = (event) => {
    let interimTranscript = '';
    for (let i = event.resultIndex; i < event.results.length; ++i) {
      interimTranscript += event.results[i][0].transcript;
    }
    procesarVoz(interimTranscript.toLowerCase());
  };

  recognition.onend = () => {
    if (isListening) recognition.start();
  };
}

function procesarVoz(frase) {
  const palabrasEscuchadas = frase.split(' ');
  const ultimaPalabra = palabrasEscuchadas[palabrasEscuchadas.length - 1];
  
  // Buscar la palabra en el texto del teleprompter
  const contenido = textElem.innerText;
  const index = contenido.toLowerCase().indexOf(ultimaPalabra);

  if (index !== -1) {
    // Creamos un rango para encontrar la posici√≥n f√≠sica de la palabra
    const range = document.createRange();
    const selection = window.getSelection();
    
    // Este es un truco para hallar las coordenadas de la palabra dentro del contenteditable
    // Buscamos el nodo de texto
    const textNode = textElem.firstChild;
    if(textNode) {
        const wordIndex = contenido.toLowerCase().lastIndexOf(ultimaPalabra);
        range.setStart(textNode, wordIndex);
        range.setEnd(textNode, wordIndex + ultimaPalabra.length);
        
        const rect = range.getBoundingClientRect();
        const offset = rect.top + viewport.scrollTop - (window.innerHeight / 2);
        
        // Hacer el scroll para centrar esa palabra
        viewport.scrollTo({
          top: offset,
          behavior: 'smooth'
        });
    }
  }
}

micBtn.onclick = () => {
  if (!isListening) {
    recognition.start();
    isListening = true;
    micBtn.classList.add("active");
    micBtn.innerText = "üõë Detener";
    textElem.contentEditable = "false"; // Bloquear edici√≥n al leer
  } else {
    recognition.stop();
    isListening = false;
    micBtn.classList.remove("active");
    micBtn.innerText = "üéôÔ∏è Iniciar Voz";
    textElem.contentEditable = "true";
  }
};

// Botones de tama√±o
let fSize = 45;
document.getElementById("plusBtn").onclick = () => { fSize += 5; textElem.style.fontSize = fSize + "px"; };
document.getElementById("minusBtn").onclick = () => { fSize -= 5; textElem.style.fontSize = fSize + "px"; };
document.getElementById("resetBtn").onclick = () => { viewport.scrollTop = 0; };

</script>
</body>
</html>
